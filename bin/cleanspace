#!/usr/bin/env bash

#
# Clean up whitespace in sourcecode files
#   - convert tabs to 2 spaces
#   - strip trailing whitespace
#

shopt -s nullglob

RECURSE=

usage() {
  echo "Usage: ${0##*/} [ -R|-r ] <targets>" >&2
}

while getopts rR opt; do
  case $opt in
    r|R) RECURSE=1 ;;
    *) usage; exit 1 ;;
  esac
done

shift $(( OPTIND - 1 ))

[[ -z $1 ]] && { usage; exit 1; }

IFS=$'\n' read -r -d'\0' -a files < <(find "$@" ${RECURSE:--maxdepth} ${RECURSE:-1} -type f 2>/dev/null)

# make sure we have something to work with
(( ${#files[@]} )) || exit 1

sed -i 's/\t/  /g;s/ *$//' "${files[@]}"

